{% extends 'base.html' %}
{% load static %}
{% block title %}
  Create Post
{% endblock %}

{% block style %}
  <link rel="stylesheet" href="{% static 'css/markdown.css' %}" />
{% endblock %}

{% block content %}
  <div class="container mt-5">
    <h2>Create a New Post</h2>
    <!-- Display form errors -->
    {% if form.errors %}
      <div class="alert alert-danger">
        <ul>
          {% for field, errors in form.errors.items %}
            <li>
              <strong>{{ field|capfirst }}:</strong> {{ errors|join:', ' }}
            </li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}

    {% comment %}Post creation form{% endcomment %}
    <form method="POST" enctype="multipart/form-data">
      {% csrf_token %}
      <div class="mb-3">
        <label for="id_title" class="form-label">Title</label>
        {{ form.title }}
      </div>
      <div class="mb-3">
        <label for="id_content" class="form-label">
          Content<div class="markdown-helper">
            <span class="text-info fs-6 fst-italic fw-light">(Markdown supported)</span>
            <div class="markdown-guide-panel">
              <h5>Markdown Guide</h5>
              <ul>
                <li>
                  <code># Heading 1</code>
                </li>
                <li>
                  <code>## Heading 2</code>
                </li>
                <li>
                  <code>**Bold Text**</code>
                </li>
                <li>
                  <code>*Italic Text*</code>
                </li>
                <li>
                  <code>[Link Text](https://...)</code>
                </li>
                <li>
                  <code>![Image Alt](https://...)</code>
                </li>
                <li>
                  <code>- List Item</code>
                </li>
                <li>
                  <code>1. Numbered Item</code>
                </li>
                <li>
                  <code>`Inline Code`</code>
                </li>
                <li>
                  <code>> Blockquote</code>
                </li>
              </ul>
            </div>
          </div>
        </label>
        {{ form.content }}
      </div>
      <div class="mb-3">
        <label for="id_banner" class="form-label">Banner Image</label>
        {{ form.banner }}
      </div>
      <button type="submit" class="btn btn-primary">Create Post</button>
    </form>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      document.querySelector('#id_title').classList.add('form-control')
      document.querySelector('#id_content').classList.add('form-control')
      document.querySelector('#id_banner').classList.add('form-control')
    
      // Markdown guide panel logic
      const helper = document.querySelector('.markdown-helper')
      const panel = document.querySelector('.markdown-guide-panel')
    
      helper.addEventListener('mouseenter', () => {
        panel.style.display = 'block'
      })
    
      helper.addEventListener('mouseleave', () => {
        panel.style.display = 'none'
      })
    })
  </script>
{% endblock %}
